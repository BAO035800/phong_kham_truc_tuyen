<!-- HEADER (Patient - Sticky, Small, Themed, No Scroll Effect) -->
<header id="mainHeader"
  class="fixed top-0 left-0 w-full z-50 bg-surface border-b border-border shadow-sm">
  
  <!-- Top bar -->
  <div class="bg-primary text-white text-sm">
    <div class="container mx-auto px-4 flex items-center justify-between py-2">
      <span id="userGreeting" class="font-medium"></span>
      <button id="logoutBtn"
        class="flex items-center gap-2 px-3 py-1 rounded-md hover:bg-white/20 transition">
        <i class="fa-solid fa-right-from-bracket text-xs"></i>
        <span>ƒêƒÉng xu·∫•t</span>
      </button>
    </div>
  </div>

  <!-- Main navigation (small & sticky) -->
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between py-2.5"> <!-- nh·ªè g·ªçn -->
      <!-- Logo -->
      <a href="#/" class="flex items-center gap-2">
        <img src="/view/assets/img/logo.png"
             onerror="this.onerror=null;this.src='https://picsum.photos/60?random=10';"
             alt="Logo" class="h-8 w-8 rounded-full object-cover shadow-sm">
        <div class="leading-tight">
          <div class="font-bold text-base text-primary">Ph√≤ng Kh√°m</div>
          <div class="text-textmuted text-[11px] tracking-wide">ChƒÉm s√≥c s·ª©c kh·ªèe t·∫≠n t√¢m</div>
        </div>
      </a>

      <!-- Menu -->
      <nav id="navMain" class="hidden lg:block font-sans">
        <ul class="flex items-center gap-1 text-[15px] font-medium">
          <li><a href="#/"           class="nav-link px-3 py-2 text-textmain relative hover:text-primary">Trang ch·ªß</a></li>
          <li><a href="#/booking"    class="nav-link px-3 py-2 text-textmain relative hover:text-primary">ƒê·∫∑t l·ªãch</a></li>
          <li><a href="#/schedule"class="nav-link px-3 py-2 text-textmain relative hover:text-primary">L·ªãch h·∫πn</a></li>
          <li><a href="#/doctors"    class="nav-link px-3 py-2 text-textmain relative hover:text-primary">B√°c sƒ©</a></li>
          <li><a href="#/contact"    class="nav-link px-3 py-2 text-textmain relative hover:text-primary">Li√™n h·ªá</a></li>
        </ul>
      </nav>

      <!-- Mobile toggle -->
      <button type="button"
        class="lg:hidden inline-flex h-9 w-9 items-center justify-center rounded-md border border-border hover:bg-bgpage transition"
        data-toggle="mobile-nav" aria-controls="navMain" aria-expanded="false" aria-label="M·ªü menu">
        <i class="fa-solid fa-bars text-textmain"></i>
      </button>
    </div>
  </div>
</header>

<!-- Spacer tr√°nh header che n·ªôi dung (cao theo header nh·ªè) -->
<div style="height: 96px;"></div>

<style>
  /* Underline effect */
  .nav-link::after{
    content:"";
    position:absolute; left:0; right:0; bottom:3px;
    height:2px; width:0%; background-color: currentColor;
    transition: width .25s ease;
  }
  .nav-link:hover::after{ width:100%; }

  /* Active state: gi·ªØ m√†u primary + g·∫°ch ch√¢n */
  .nav-link.active{
    color:#0096C7; /* primary */
    font-weight:600;
  }
  .nav-link.active::after{ width:100%; }
</style>

<script>
(function () {
  // Greeting
  try{
    const user = JSON.parse(localStorage.getItem("user") || "null");
    const greet = document.getElementById("userGreeting");
    if (user && greet) greet.textContent = `Xin ch√†o, ${user.name} üëã`;
  }catch(_){}

  // Chu·∫©n ho√° hash (h·ªó tr·ª£ index.html?#/booking)
  function cleanHash(){
    const h = window.location.hash || "";
    if (h.startsWith("?#")) return "#" + h.slice(2);
    return h || "#/";
  }

  // Set active link theo route
  function setActive(){
    const current = cleanHash();
    document.querySelectorAll(".nav-link").forEach(a=>{
      a.classList.toggle("active", a.getAttribute("href") === current);
    });
  }
  setActive();
  window.addEventListener("hashchange", setActive);

  // Logout
  const logoutBtn = document.getElementById("logoutBtn");
  const headerContainer = document.getElementById("header");
  if (logoutBtn && headerContainer){
    logoutBtn.addEventListener("click", async ()=>{
      localStorage.removeItem("user");
      const res = await fetch("./components/layout/header_guest.html?v=" + Date.now(), { cache: "no-store" });
      headerContainer.innerHTML = await res.text();
      window.location.hash = "#/login";
      if (typeof renderPage === "function") renderPage();
    });
  }

  // Mobile nav toggle
  const btn = document.querySelector('[data-toggle="mobile-nav"]');
  const nav = document.getElementById("navMain");
  if (btn && nav){
    btn.addEventListener("click", ()=>{
      const isOpen = !nav.classList.contains("hidden");
      nav.classList.toggle("hidden", isOpen);
      btn.setAttribute("aria-expanded", String(!isOpen));
    });
  }
})();
</script>
